/**
 * note記事のスタイルガイド
 * 全エージェントで共通して使用するnote記事のベストプラクティス
 */

export const NOTE_STYLE_GUIDE = `
# note記事スタイルガイド

## 基本原則

### 口調・トーン
- 基本は「です・ます」体で丁寧に
- カフェで向かい合って話すような対話感を意識
- 問いかけを多用する（「〇〇な経験、ありませんか？」「どう感じましたか？」）
- 自己開示と感情表現を豊かに（「本当に嬉しくて」「正直に言うと、焦っていました」）
- 適度な口語表現（「〜なんですよね」「〜だったりします」「ぐっと良くなる」）
- 読者に寄り添う優しい言葉遣い

### 構成の流れ
1. **共感フック**: 読者の悩みを言語化し、「これ、まさに自分のことだ！」と感じてもらう
2. **結論の先出し**: 要点を3-5個にまとめて先に提示
3. **体験談**: 失敗→発見→実践→結果（数値データ必須）
4. **再現パート**: 読者が「明日できる」具体的な手順
5. **反論・落とし穴**: よくある質問に先回りして回答（NG例→OK例）
6. **まとめ**: 優しく背中を押す＋最小の一歩を提示

### スマホ最適化（超重要）
- **段落は2-4行で区切る**（1段落=1メッセージ）
- **一文ごとに改行を入れる**（視覚的な余白を作る）
- 箇条書き・太字・引用を効果的に使う
- PC画面で「少しスカスカ」に見えるくらいが、スマホでちょうど良い

### 具体例の重要性
- 抽象論ではなく、具体的な数値・固有名詞・事例を盛り込む
- 「効果がありました」→「PVが3倍（300→900）になりました」
- 「便利なツール」→「Notionのテンプレート機能」

### 読者との距離感
- 上から目線を避ける
- 「一緒に学び合いましょう」というスタンス
- 失敗談を惜しみなく共有して親近感を持ってもらう
`;

export const NOTE_GATING_GUIDE = `
# 有料ゲーティングガイド

## 基本原則
**無料部分（60-70%）で信頼を得て、有料部分（30-40%）で再現性を渡す**

### 無料部分に含めるべき内容
- 共感フック（読者の悩みを言語化）
- 結論の先出し（要点3-5個）
- 体験談（失敗→発見まで）
- 全体像・考え方・基本的な手順の概要
- よくある間違い（一部）

**目的**: 「この人は信頼できる」「価値がある」と感じてもらう

### 有料部分に含めるべき内容（再現性の核）
- 具体的な手順書（詳細版）
- 実例・ケーススタディ（具体名・数値）
- テンプレート・チェックリスト（コピペ可能）
- ダウンロード素材
- ケース別の落とし穴と回避策
- 交渉文面・メール例文

**目的**: 「買ってよかった」「明日から実践できる」と確信してもらう

### ゲート位置の推奨パターン
**パターンA（推奨）**: 体験談の「実践」部分の途中
- 無料: 失敗→発見→実践の概要
- 有料: 実践の詳細→結果→再現手順→付録

### 価格設定の目安
- **500-800円**: 3,000-5,000字、手順書・チェックリスト中心
- **1,000-1,500円**: 5,000-8,000字、深掘り・事例詳細・テンプレート充実
- **2,000円以上**: 8,000字以上、専門性・希少性が高い

**判断基準**:
- この記事で読者はどれくらいの時間を節約できるか？
- この情報を自分で集めたら、どれくらいの時間とお金がかかるか？
- 初回は「買い得」を意識して価格を抑える
`;

export const NOTE_CTA_PATTERNS = `
# CTAパターン

## 冒頭フォロー誘導（固定文）
\`\`\`
---

💡 **この記事が役に立ったら、ぜひフォローをお願いします！**

週1-2回、実践的な[あなたのテーマ]をお届けしています。

👉 [フォローはこちら](プロフィールURL)

---
\`\`\`

## 無料記事末尾CTA
\`\`\`
---

## この記事が役に立ったら

💚 **スキ**を押していただけると嬉しいです！

📚 **関連記事**:
- [記事タイトル1](URL)
- [記事タイトル2](URL)
- [記事タイトル3](URL)

🔔 **フォロー**していただくと、新着記事をお届けします
👉 [フォローはこちら](プロフィールURL)

---

💬 **質問・感想をお待ちしています**

この記事について、わからないことや試してみた結果など、コメントで教えてください！
\`\`\`

## 有料ブリッジ（無料→有料の境界）
\`\`\`
---

## ここから先は有料部分です

ここまでお読みいただき、ありがとうございます。

ここから先では、以下の内容を詳しく解説しています：

✅ **[具体的な内容1]** - 〇〇の詳細な手順
✅ **[具体的な内容2]** - △△の実例とケーススタディ
✅ **[具体的な内容3]** - □□のチェックリスト
✅ **[ダウンロード特典]** - テンプレート・スプレッドシート

「明日から使える」実践的な内容を、惜しみなく詰め込みました。

あなたの[目標]が、少しでも前に進むきっかけになれば嬉しいです。

**価格**: ¥[金額]

---
\`\`\`

## 有料記事末尾CTA
\`\`\`
---

## 最後まで読んでくださって、ありがとうございます

この記事が、あなたの[目標]の役に立てば嬉しいです。

### 💚 スキを押してください

「役に立った！」と感じたら、ぜひスキを押してください。
あなたのスキが、次の記事を書く励みになります。

### 💬 実践した結果を教えてください

この記事の内容を実践してみて、どうだったか教えてください。

- うまくいったこと
- 困ったこと
- もっと知りたいこと

コメントでシェアしていただけると嬉しいです！

### 🔔 フォローで最新情報をキャッチ

週1-2回、実践的なノウハウをお届けしています。

👉 [フォローはこちら](プロフィールURL)

---

あなたの成功を、心から応援しています！

---
\`\`\`
`;

export const NOTE_TITLE_FORMULA = `
# タイトル作成の方程式

## 基本フォーマット
{数字/期間} + {結果/ベネフィット} + {具体/体験} + {疑問/逆説}

## 良い例
- 「3年伸びなかったnoteが"1つの修正"で売上2倍になった話」
- 「月5万円稼ぐnote執筆術｜初心者が30日で達成した7つのステップ」
- 「なぜあなたのnoteは読まれないのか？｜1000記事分析でわかった致命的な3つの間違い」

## 避けるべき例
- 「noteについて」（抽象的すぎる）
- 「私の体験談」（ベネフィットが不明）
- 「note執筆のコツをまとめました」（平凡すぎる）

## 評価軸
1. **具体性**: 数字・期間・固有名詞があるか（3点）
2. **ベネフィット**: 読者が得られるものが明確か（3点）
3. **体験/証拠**: 実体験・データがあることが伝わるか（2点）
4. **興味喚起**: 疑問形・逆説・意外性があるか（2点）

合計10点満点で7点以上を目指す
`;

export const NOTE_SECTION_TEMPLATES = `
# セクションテンプレート

## 1. 共感フック
\`\`\`
こんな経験、ありませんか？

- [悩み1]
- [悩み2]
- [悩み3]

私も、まったく同じ悩みを抱えていました。

[短い失敗エピソード 2-3文]
\`\`\`

## 2. 結論の先出し
\`\`\`
結論から言うと、[目標]を実現するには以下の3つが重要です。

1. **[見出し1]**: [一言説明]
2. **[見出し2]**: [一言説明]
3. **[見出し3]**: [一言説明]

この記事では、それぞれを具体的に解説し、すぐに使えるテンプレートもご用意しました。

それでは、順番に見ていきましょう。
\`\`\`

## 3. 体験談（失敗→発見→実践→結果）
各パートで具体的なエピソードと感情を描写する。
結果パートでは必ず数値データを含める。

## 4. 再現パート（各ステップ）
\`\`\`
## ステップ[N]: [見出し]

[なぜこれが重要か]

[具体的な手順]

**チェックリスト**:
- [ ] [項目1]
- [ ] [項目2]
- [ ] [項目3]

**よくある間違い**:
❌ [NG例]
✅ [OK例]
\`\`\`

## 5. よくある質問
\`\`\`
### Q: [質問]

A: [回答]

**NG例**: [やってしまいがちな間違い]
**OK例**: [正しいアプローチ]
\`\`\`

## 6. まとめ
\`\`\`
## まとめ：今日から始められる最初の一歩

ここまで、[テーマ]について解説してきました。

**もう一度、要点をまとめます**:

1. [要点1]
2. [要点2]
3. [要点3]

「難しそう…」と感じた方もいるかもしれません。

でも、大丈夫です。

まずは[最小の一歩]から始めてみてください。

たとえば、
- 今日は[小さなアクション1]
- 明日は[小さなアクション2]

そんな小さな積み重ねが、3ヶ月後には大きな変化になります。

もしこの記事が、あなたの次の一歩のきっかけになれば嬉しいです。
\`\`\`
`;

export const NOTE_FORMATTING_RULES = `
# フォーマットルール

## 段落の書き方
- 1段落は2-4行まで
- 1段落には1つのメッセージのみ
- 一文ごとに改行を入れる

## 悪い例
\`\`\`
noteで収益化するためには、まず読者の悩みを深く理解することが重要です。そのためには、コメント欄やSNSでの反応を丁寧に観察し、どんな言葉に反応しているかを分析する必要があります。また、自分自身の体験を振り返り、当時どんな情報を求めていたかを思い出すことも効果的です。
\`\`\`

## 良い例
\`\`\`
noteで収益化するためには、まず読者の悩みを深く理解することが重要です。

そのためには、コメント欄やSNSでの反応を丁寧に観察しましょう。
どんな言葉に反応しているかを分析します。

また、自分自身の体験を振り返ることも効果的です。
当時、どんな情報を求めていたかを思い出してみてください。
\`\`\`

## 箇条書きの活用
- 情報を整理する時は積極的に箇条書きを使う
- 3-5個程度にまとめる
- 各項目は簡潔に

## 太字の使い方
- 本当に重要な部分だけを太字にする
- 多用しすぎない（1段落に1箇所まで）
- 見出しではなく、本文中のキーワードに使う

## 引用の使い方
- 心に残る言葉や重要な原則を引用ブロックで強調
- 外部からの引用には出典を明記
`;

/**
 * エージェント用のシステムプロンプトを生成
 */
export function getNoteStylePrompt(role: 'strategy' | 'draft' | 'editor' | 'cta' | 'pricing'): string {
  const baseStyle = NOTE_STYLE_GUIDE + '\n\n' + NOTE_FORMATTING_RULES;
  
  switch (role) {
    case 'strategy':
      return baseStyle + '\n\n' + NOTE_TITLE_FORMULA;
    case 'draft':
      return baseStyle + '\n\n' + NOTE_SECTION_TEMPLATES;
    case 'editor':
      return baseStyle + '\n\n' + NOTE_SECTION_TEMPLATES;
    case 'cta':
      return NOTE_CTA_PATTERNS;
    case 'pricing':
      return NOTE_GATING_GUIDE;
    default:
      return baseStyle;
  }
}

/**
 * タイトルを評価する関数
 */
export function scoreTitleCandidate(title: string): {
  score: number;
  breakdown: {
    specificity: number;
    benefit: number;
    experience: number;
    curiosity: number;
  };
  feedback: string;
} {
  const breakdown = {
    specificity: 0,
    benefit: 0,
    experience: 0,
    curiosity: 0,
  };

  // 具体性（数字・期間・固有名詞）
  if (/\d+/.test(title)) breakdown.specificity += 2;
  if (/(年|ヶ月|週間|日|時間|分)/.test(title)) breakdown.specificity += 1;
  breakdown.specificity = Math.min(3, breakdown.specificity);

  // ベネフィット（結果・成果を示す言葉）
  if (/(達成|実現|成功|改善|向上|増加|倍|稼ぐ|売上|収益)/.test(title)) breakdown.benefit += 2;
  if (/(方法|術|コツ|秘訣|ステップ)/.test(title)) breakdown.benefit += 1;
  breakdown.benefit = Math.min(3, breakdown.benefit);

  // 体験/証拠
  if (/(した話|してみた|実際に|体験|経験|試した)/.test(title)) breakdown.experience += 2;

  // 興味喚起（疑問形・逆説）
  if (/(？|なぜ|どう|どのように)/.test(title)) breakdown.curiosity += 1;
  if (/(でも|しかし|実は|意外|驚き|間違い)/.test(title)) breakdown.curiosity += 1;
  breakdown.curiosity = Math.min(2, breakdown.curiosity);

  const score = breakdown.specificity + breakdown.benefit + breakdown.experience + breakdown.curiosity;

  let feedback = '';
  if (breakdown.specificity < 2) feedback += '数字や期間を追加すると良いでしょう。';
  if (breakdown.benefit < 2) feedback += '読者が得られる具体的なベネフィットを明示しましょう。';
  if (breakdown.experience === 0) feedback += '体験談であることを示す言葉を入れると信頼性が上がります。';
  if (breakdown.curiosity === 0) feedback += '疑問形や逆説を使うと興味を引きやすくなります。';

  return { score, breakdown, feedback: feedback || 'バランスの良いタイトルです！' };
}

